#!/usr/bin/env python

import imaplib
from email.parser import HeaderParser
import time


USR = ''  # your gmail address
PWD = ''  # password


def show_unread_emails():
    """shows unread emails from past hour"""
    parser = HeaderParser()

    imap_server = imaplib.IMAP4_SSL('imap.gmail.com', 993)
    imap_server.login(USR, PWD)
    imap_server.select('Inbox')

    th = time.time() - 3600  # search messages from the last hour
    query = '(X-GM-RAW "after:%d is:unread")' % th

    for message_id in imap_server.search(None, query)[1][0].split(" "):
        response = imap_server.fetch(message_id,
                                     "(BODY[HEADER.FIELDS (SUBJECT FROM)])")
        header_data = response[1][0][1]
        msg = parser.parsestr(header_data)
        print msg
        imap_server.store(message_id, '-FLAGS', '\\Seen')


if __name__ == '__main__':
    show_unread_emails()
